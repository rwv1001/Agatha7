console.log('Welcome: Creating new entry for table: ' + '<%="#{table_name}"%>' + ', class: ' + '<%="#{class_name}"%>' + ', id: ' + '<%="#{id}"%>');

// Add the new object to the bottom of search results regardless of filter settings
<% if new_row && local_assigns[:search_done] %>
  (function() {
    const newRowSearchTable = document.getElementById("search_results_table_<%= class_name %>");
    if (newRowSearchTable) {
      const newRowHtml = `<%= j render(:partial => 'shared/search_results_row_button', :object => new_row) %>`;
      const lastTr = newRowSearchTable.querySelector("tr:last-child");
      if (lastTr) {
        lastTr.insertAdjacentHTML("afterend", newRowHtml);
        console.log('‚úÖ Added new <%= class_name %> (ID: <%= id %>) to bottom of search results');
        
        // Apply proper cell display based on current display settings
        const newRowElement = document.getElementById('<%= id %>_<%= class_name %>');
        if (newRowElement) {
          console.log('üîß Applying hideCellsBasedOnCurrentDisplay to newly created row');
          
          if (typeof window.hideCellsBasedOnCurrentDisplay === 'function') {
            window.hideCellsBasedOnCurrentDisplay(newRowElement, '<%= class_name %>');
            console.log('‚úÖ Successfully applied hideCellsBasedOnCurrentDisplay');
          } else {
            console.log('‚ö†Ô∏è hideCellsBasedOnCurrentDisplay function not available');
          }
        } else {
          console.log('‚ö†Ô∏è Could not find newly created row element');
        }
        
        if (window.showNotification) {
          window.showNotification('New <%= class_name %> created successfully', 'success');
        } else {
          alert('New <%= class_name %> created successfully');
        }
      } else {
        console.warn('‚ùå Could not find last row in search results table');
      }
    } else {
      console.log('‚ÑπÔ∏è No search results table found for <%= class_name %> - object created but not added to results');
    }
  })();

  attribute_opener ='';
  open_edit_window(attribute_opener, 1, '<%="#{table_name}"%>', '<%="#{class_name}"%>', '<%="#{id}"%>');
<% else %>
  console.log('‚ÑπÔ∏è No search row data available or search not done - you may need to open a <%= class_name %> search table first');
  <% unless local_assigns[:search_done] %>
    console.log('‚ÑπÔ∏è Search not done - new table will be created with this entry');
  <% end %>
<% end %>
