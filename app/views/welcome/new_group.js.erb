

<% if existing_group.nil? %>
  <% table_name.set_controller(search_ctl) %>
  <% updated_objects = search_ctl.GetUpdateObjects(table_name, ["id"], ids) %>
  <% updated_objects.each do |row| %>
    (function(){
      const el = document.getElementById("<%= "#{row.id}_#{table_name}" %>");
      if (el) {
        // replaceWith: swap the elementâ€™s outerHTML
        el.outerHTML = "<%= j render(partial: 'shared/search_results_row_button', object: row).gsub("\"","\\\"") %>";
      }
    })();
  <% end %>

  recolour("<%= table_name %>");

  <% table_name = "Group" %>
  <% table_name.set_controller(search_ctl_group) %>
  <% updated_objects = search_ctl_group.GetUpdateObjects(table_name, ["id"], [new_group_id]) %>
  <% updated_objects.each do |row| %>
    (function(){
      const el = document.getElementById("<%= "#{row.id}_#{table_name}" %>");
      if (el) {
        el.outerHTML = "<%= j render(partial: 'shared/search_results_row_button', object: row) %>";
      }
    })();
  <% end %>

  <% results_table_name    = "search_results_table_Group" %>
  <% current_filter_name   = "current_filters_Group" %>
  document.getElementById("<%= current_filter_name %>").style.display = "none";

  <% table_name.set_controller(search_ctl_group) %>
  <% select_string = search_ctl.get_sql_id_string([new_group_id]) %>
  <% new_rows = Group.find_by_sql(select_string) %>
  <% new_rows.each do |new_row| %>
    (function(){
      const resultsTable = document.getElementById("<%= results_table_name %>");
      const rowHtml      = "<%= j render(partial: 'shared/search_results_row_button', object: new_row) %>";
      if (resultsTable) {
        // insertAfter last row
        const lastTr = resultsTable.querySelector("tr:last-child");
        if (lastTr) lastTr.insertAdjacentHTML("afterend", rowHtml);
      } else {
        // replace entire results container
        document.getElementById("search_results_<%= table_name %>").innerHTML =
          "<%= j render(partial: 'shared/search_results', object: SearchResults.new([new_row], :search_results, search_ctl_group)) %>";
        resizeX();
      }

      const newOptionStr = "<%= search_ctl_group.GetShortField(new_row.id) %>";
      select_update("Group", <%= new_row.id %>, newOptionStr);
    })();
  <% end %>

  recolour("Group");
  action_select_no_js();
  alert("Successfully created <%= class_name %> group with name <%= group_name %>");
<% else %>
  alert("Group creation failed: <%= class_name %> group with name <%= group_name %> already exists.");
<% end %>

unwait();

    
